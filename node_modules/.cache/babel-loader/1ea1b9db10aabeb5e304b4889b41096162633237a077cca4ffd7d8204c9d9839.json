{"ast":null,"code":"function _slicedToArray(arr, i) { return _arrayWithHoles(arr) || _iterableToArrayLimit(arr, i) || _unsupportedIterableToArray(arr, i) || _nonIterableRest(); }\nfunction _nonIterableRest() { throw new TypeError(\"Invalid attempt to destructure non-iterable instance.\\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.\"); }\nfunction _unsupportedIterableToArray(o, minLen) { if (!o) return; if (typeof o === \"string\") return _arrayLikeToArray(o, minLen); var n = Object.prototype.toString.call(o).slice(8, -1); if (n === \"Object\" && o.constructor) n = o.constructor.name; if (n === \"Map\" || n === \"Set\") return Array.from(o); if (n === \"Arguments\" || /^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)) return _arrayLikeToArray(o, minLen); }\nfunction _arrayLikeToArray(arr, len) { if (len == null || len > arr.length) len = arr.length; for (var i = 0, arr2 = new Array(len); i < len; i++) arr2[i] = arr[i]; return arr2; }\nfunction _iterableToArrayLimit(r, l) { var t = null == r ? null : \"undefined\" != typeof Symbol && r[Symbol.iterator] || r[\"@@iterator\"]; if (null != t) { var e, n, i, u, a = [], f = !0, o = !1; try { if (i = (t = t.call(r)).next, 0 === l) { if (Object(t) !== t) return; f = !1; } else for (; !(f = (e = i.call(t)).done) && (a.push(e.value), a.length !== l); f = !0); } catch (r) { o = !0, n = r; } finally { try { if (!f && null != t.return && (u = t.return(), Object(u) !== u)) return; } finally { if (o) throw n; } } return a; } }\nfunction _arrayWithHoles(arr) { if (Array.isArray(arr)) return arr; }\nimport QRCode from 'qrcode';\nimport * as React from 'react';\nimport { ConsoleLogger } from 'aws-amplify/utils';\nimport { authenticatorTextUtil, getTotpCodeURL } from '@aws-amplify/ui';\nimport { Flex } from '../../../primitives/Flex/Flex.mjs';\nimport { Heading } from '../../../primitives/Heading/Heading.mjs';\nimport { useAuthenticator } from '@aws-amplify/ui-react-core';\nimport { useCustomComponents } from '../hooks/useCustomComponents/useCustomComponents.mjs';\nimport { useFormHandlers } from '../hooks/useFormHandlers/useFormHandlers.mjs';\nimport { ConfirmSignInFooter } from '../shared/ConfirmSignInFooter.mjs';\nimport { RemoteErrorMessage } from '../shared/RemoteErrorMessage.mjs';\nimport { FormFields } from '../shared/FormFields.mjs';\nimport { RouteContainer } from '../RouteContainer/RouteContainer.mjs';\nconst logger = new ConsoleLogger('SetupTotp-logger');\nconst getSetupTotpText = authenticatorTextUtil.getSetupTotpText,\n  getCopiedText = authenticatorTextUtil.getCopiedText,\n  getLoadingText = authenticatorTextUtil.getLoadingText;\nconst SetupTotp = _ref => {\n  let className = _ref.className,\n    variation = _ref.variation;\n  const _useAuthenticator = useAuthenticator(context => [context.isPending, context.totpSecretCode, context.username]),\n    totpSecretCode = _useAuthenticator.totpSecretCode,\n    isPending = _useAuthenticator.isPending,\n    username = _useAuthenticator.username,\n    QRFields = _useAuthenticator.QRFields;\n  const _useFormHandlers = useFormHandlers(),\n    handleChange = _useFormHandlers.handleChange,\n    handleSubmit = _useFormHandlers.handleSubmit;\n  const _useCustomComponents = useCustomComponents(),\n    _useCustomComponents$ = _useCustomComponents.components.SetupTotp,\n    _useCustomComponents$2 = _useCustomComponents$.Header,\n    Header = _useCustomComponents$2 === void 0 ? SetupTotp.Header : _useCustomComponents$2,\n    _useCustomComponents$3 = _useCustomComponents$.Footer,\n    Footer = _useCustomComponents$3 === void 0 ? SetupTotp.Footer : _useCustomComponents$3;\n  const _React$useState = React.useState(true),\n    _React$useState2 = _slicedToArray(_React$useState, 2),\n    isLoading = _React$useState2[0],\n    setIsLoading = _React$useState2[1];\n  const _React$useState3 = React.useState(),\n    _React$useState4 = _slicedToArray(_React$useState3, 2),\n    qrCode = _React$useState4[0],\n    setQrCode = _React$useState4[1];\n  const _React$useState5 = React.useState('COPY'),\n    _React$useState6 = _slicedToArray(_React$useState5, 2),\n    copyTextLabel = _React$useState6[0],\n    setCopyTextLabel = _React$useState6[1];\n  const _ref2 = QRFields ?? {},\n    _ref2$totpIssuer = _ref2.totpIssuer,\n    totpIssuer = _ref2$totpIssuer === void 0 ? 'AWSCognito' : _ref2$totpIssuer,\n    _ref2$totpUsername = _ref2.totpUsername,\n    totpUsername = _ref2$totpUsername === void 0 ? username : _ref2$totpUsername;\n  const generateQRCode = React.useCallback(async () => {\n    try {\n      const totpCode = getTotpCodeURL(totpIssuer, totpUsername, totpSecretCode);\n      const qrCodeImageSource = await QRCode.toDataURL(totpCode);\n      setQrCode(qrCodeImageSource);\n    } catch (error) {\n      logger.error(error);\n    } finally {\n      setIsLoading(false);\n    }\n  }, [totpIssuer, totpUsername, totpSecretCode]);\n  React.useEffect(() => {\n    if (!qrCode) {\n      generateQRCode();\n    }\n  }, [generateQRCode, qrCode]);\n  const copyText = () => {\n    navigator.clipboard.writeText(totpSecretCode);\n    setCopyTextLabel(getCopiedText());\n  };\n  return /*#__PURE__*/React.createElement(RouteContainer, {\n    className: className,\n    variation: variation\n  }, /*#__PURE__*/React.createElement(\"form\", {\n    \"data-amplify-form\": \"\",\n    \"data-amplify-authenticator-setup-totp\": \"\",\n    method: \"post\",\n    onChange: handleChange,\n    onSubmit: handleSubmit\n  }, /*#__PURE__*/React.createElement(Flex, {\n    as: \"fieldset\",\n    direction: \"column\",\n    isDisabled: isPending\n  }, /*#__PURE__*/React.createElement(Header, null), /*#__PURE__*/React.createElement(Flex, {\n    direction: \"column\"\n  }, isLoading ? ( /*#__PURE__*/React.createElement(\"p\", null, getLoadingText(), \"\\u2026\")) : ( /*#__PURE__*/React.createElement(\"img\", {\n    \"data-amplify-qrcode\": true,\n    src: qrCode,\n    alt: \"qr code\",\n    width: \"228\",\n    height: \"228\"\n  })), /*#__PURE__*/React.createElement(Flex, {\n    \"data-amplify-copy\": true\n  }, /*#__PURE__*/React.createElement(\"div\", null, totpSecretCode), /*#__PURE__*/React.createElement(Flex, {\n    \"data-amplify-copy-svg\": true,\n    onClick: copyText\n  }, /*#__PURE__*/React.createElement(\"div\", {\n    \"data-amplify-copy-tooltip\": true\n  }, copyTextLabel), /*#__PURE__*/React.createElement(\"svg\", {\n    width: \"24\",\n    height: \"24\",\n    viewBox: \"0 0 24 24\",\n    xmlns: \"http://www.w3.org/2000/svg\"\n  }, /*#__PURE__*/React.createElement(\"path\", {\n    d: \"M16 1H4C2.9 1 2 1.9 2 3V17H4V3H16V1ZM15 5H8C6.9 5 6.01 5.9 6.01 7L6 21C6 22.1 6.89 23 7.99 23H19C20.1 23 21 22.1 21 21V11L15 5ZM8 21V7H14V12H19V21H8Z\"\n  })))), /*#__PURE__*/React.createElement(FormFields, null), /*#__PURE__*/React.createElement(RemoteErrorMessage, null)), /*#__PURE__*/React.createElement(ConfirmSignInFooter, null), /*#__PURE__*/React.createElement(Footer, null))));\n};\nSetupTotp.Header = function Header() {\n  return /*#__PURE__*/React.createElement(Heading, {\n    level: 3\n  }, getSetupTotpText());\n};\nSetupTotp.Footer = function Footer() {\n  // @ts-ignore\n  return null;\n};\nexport { SetupTotp };","map":null,"metadata":{},"sourceType":"module","externalDependencies":[]}